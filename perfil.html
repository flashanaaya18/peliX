<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TiendaPeliX - Mi Perfil</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="movil.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Fondo animado -->
    <div class="background-animation"></div>
    <div class="particles-container" id="particles-container"></div>

    <!-- Formularios HTML ocultos para que Netlify los detecte -->
    <form name="recarga-saldo" netlify netlify-honeypot="bot-field" hidden aria-hidden="true">
        <input type="email" name="email" />
        <select name="pais"></select>
        <input type="number" name="monto" />
    </form>
    <form name="reporte-problema" netlify netlify-honeypot="bot-field" hidden aria-hidden="true">
        <input type="text" name="nombre" />
        <input type="tel" name="telefono" />
        <select name="cuenta_seleccionada"></select>
        <textarea name="descripcion"></textarea>
        <input type="text" name="producto" /> 
        <input type="text" name="correo_cuenta" />
        <input type="text" name="clave_cuenta" />
    </form>
    <!-- Fin del formulario oculto -->


    <!-- Header con Navbar de Bootstrap -->
    <header class="fixed-top">
        <nav class="navbar navbar-expand-lg" data-bs-theme="dark">
            <div class="container-fluid">
                <a class="navbar-brand logo" href="peliX.html">
                    <div class="logo-icon">🎬</div>
                    <h1>TiendaPeliX</h1>
                </a>
                <!-- Botón para abrir el menú Overlay en móviles -->
                <button class="navbar-toggler" type="button" id="open-menu-btn" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <!-- Menú para pantallas grandes (PC) -->
                <div class="collapse navbar-collapse d-none d-lg-flex justify-content-end" id="navbarNav">
                    <ul class="navbar-nav align-items-center">
                        <li class="nav-item"><a class="nav-link" href="peliX.html">Inicio</a></li>
                        <li class="nav-item"><a class="nav-link" href="tienda.html">Tienda</a></li>
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="perfil.html">Perfil</a></li>
                        <li class="nav-item"><a class="nav-link" href="favoritos.html">Favoritos</a></li>
                        <li class="nav-item"><div class="dropdown"><button class="btn btn-outline-light btn-sm dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false"><span id="country-flag-display" class="me-2"></span><span id="country-currency-display">USD</span></button><ul class="dropdown-menu dropdown-menu-end" id="country-selector-dropdown"></ul></div></li>
                        <li class="nav-item"><a href="carrito.html" class="nav-link cart-link-bootstrap"><i class="bi bi-cart-fill me-1"></i> Carrito (<span id="cart-count">0</span>)</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Menú Overlay a Pantalla Completa para Móviles -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay">
        <button id="close-menu-btn" class="close-menu-btn">&times;</button>
        <div class="mobile-menu-content">
            <a class="mobile-menu-link" href="peliX.html">Inicio</a>
            <a class="mobile-menu-link" href="tienda.html">Tienda</a>
            <a class="mobile-menu-link" href="perfil.html">Perfil</a>
            <a class="mobile-menu-link" href="favoritos.html">Favoritos</a>
            <a class="mobile-menu-link" href="carrito.html">Carrito</a>
            <div id="mobile-country-selector" class="mt-4"></div>
        </div>
    </div>

    <main class="container mt-5 pt-5">
        <div class="section-header text-center mb-5">
            <h2 class="display-5 fw-bold">👤 Mi Perfil</h2>
            <p class="text-white-50">Tu información, saldo y productos favoritos en un solo lugar.</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Sección para identificarse -->
                <div class="settings-card p-4 mb-5">
                    <h4 class="mb-3"><i class="bi bi-person-check-fill me-2"></i>Ver mi información</h4>
                    <div class="input-group">
                        <input type="email" id="profile-email" class="form-control" placeholder="Introduce tu correo para ver tu perfil">
                        <button class="btn btn-primary cta-button" id="view-profile-btn">Ver Perfil</button>
                    </div>
                </div>

                <!-- Contenedor para la información del perfil (oculto por defecto) -->
                <div id="profile-info-container" class="d-none">
                    <!-- Display del usuario logueado -->
                    <div class="d-flex align-items-center mb-4 p-3 settings-card">
                        <div>
                            <h4 id="user-name-display" class="mb-0"></h4>
                            <p id="user-email-display" class="text-white-50 mb-0"></p>
                        </div>
                        <span id="user-badge-icon"></span>
                    </div>

                    
                    <ul class="nav nav-pills nav-fill mb-4 profile-tabs" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pills-saldo-tab" data-bs-toggle="pill" data-bs-target="#pills-saldo" type="button" role="tab" aria-controls="pills-saldo" aria-selected="true"><i class="bi bi-wallet2 me-2"></i>Saldo</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-pedidos-tab" data-bs-toggle="pill" data-bs-target="#pills-pedidos" type="button" role="tab" aria-controls="pills-pedidos" aria-selected="false"><i class="bi bi-bag-check-fill me-2"></i>Pedidos</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-coleccion-tab" data-bs-toggle="pill" data-bs-target="#pills-coleccion" type="button" role="tab" aria-controls="pills-coleccion" aria-selected="false"><i class="bi bi-star-fill me-2"></i>Colección</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-ajustes-tab" data-bs-toggle="pill" data-bs-target="#pills-ajustes" type="button" role="tab" aria-controls="pills-ajustes" aria-selected="false"><i class="bi bi-gear-fill me-2"></i>Ajustes</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-soporte-tab" data-bs-toggle="pill" data-bs-target="#pills-soporte" type="button" role="tab" aria-controls="pills-soporte" aria-selected="false"><i class="bi bi-headset me-2"></i>Soporte</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-novedades-tab" data-bs-toggle="pill" data-bs-target="#pills-novedades" type="button" role="tab" aria-controls="pills-novedades" aria-selected="false"><i class="bi bi-newspaper me-2"></i>Novedades</button>
                        </li>
                    </ul>

                    
                    <div class="tab-content" id="pills-tabContent">
                        
                        <div class="tab-pane fade show active" id="pills-saldo" role="tabpanel" aria-labelledby="pills-saldo-tab" tabindex="0">
                            <div class="row gy-4">
                                <div class="col-md-5">
                                    <div class="settings-card p-4 h-100 text-center">
                                        <h4 class="mb-3"><i class="bi bi-wallet2 me-2"></i>Mi Saldo</h4>
                                        <p class="display-4 fw-bold text-success mb-1" id="profile-balance">$0.00</p>
                                        <button class="btn btn-link text-white-50 btn-sm" data-bs-toggle="modal" data-bs-target="#transactionHistoryModal">
                                            Ver historial detallado
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="settings-card p-4 h-100">
                                        <h4 class="mb-3"><i class="bi bi-cash-coin me-2"></i>Solicitar Recarga</h4>
                                        <form id="saldo-form" method="POST">
                                            <p class="d-none"><label>Don’t fill this out if you’re human: <input name="bot-field" /></label></p>
                                            <input type="hidden" name="form-name" value="recarga-saldo" />
                                            <input type="email" class="form-control mb-3" id="email" name="email" required readonly style="background-color: #333;"/>
                                            <div class="mb-3"><label for="country" class="form-label">País</label><select class="form-select" id="country" name="pais" required></select></div>
                                            <div class="mb-3"><label for="amount" class="form-label">Monto</label><div class="input-group"><span class="input-group-text" id="currency-symbol">$</span><input type="number" class="form-control" id="amount" name="monto" placeholder="100" min="1" required></div></div>
                                            <div class="d-grid"><button type="submit" class="btn btn-primary cta-button">Solicitar</button></div>
                                        </form>
                                        <div id="success-message" class="alert alert-success mt-3 d-none" role="alert">¡Solicitud enviada!</div>
                                    </div>
                                </div>
                                <!-- Nuevas Funcionalidades de Saldo -->
                                <div class="col-md-6">
                                    <div class="settings-card p-4 h-100">
                                        <h4 class="mb-3"><i class="bi bi-award-fill me-2"></i>Puntos de Lealtad</h4>
                                        <p class="text-white-50 small">Gana puntos con cada compra y canjéalos por saldo.</p>
                                        <div class="text-center bg-dark p-3 rounded-3 mb-3">
                                            <div class="fs-1 fw-bold text-warning" id="loyalty-points-balance">0</div>
                                            <div class="text-white-50">Puntos Disponibles</div>
                                        </div>
                                        <div class="d-grid"><button class="btn btn-outline-warning" id="redeem-points-btn">Canjear Puntos</button></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="settings-card p-4 h-100">
                                        <h4 class="mb-3"><i class="bi bi-gift-fill me-2"></i>Canjear Código</h4>
                                        <label for="gift-code-input" class="form-label">Ingresa un código de regalo</label>
                                        <div class="input-group"><input type="text" class="form-control" id="gift-code-input" placeholder="XXXX-XXXX-XXXX"><button class="btn btn-outline-success" id="redeem-gift-code-btn">Canjear</button></div>
                                    </div>
                                </div>
                                <!-- Nueva Funcionalidad: Recompensas por Racha Diaria -->
                                <div class="col-lg-12">
                                    <div class="settings-card p-4 h-100">
                                        <h4 class="mb-3"><i class="bi bi-calendar-check-fill me-2"></i>Recompensa Diaria</h4>
                                        <p class="text-white-50 small">¡Inicia sesión cada día para aumentar tu racha y ganar más puntos!</p>
                                        <div class="row align-items-center text-center">
                                            <div class="col-md-6">
                                                <div class="fs-1 fw-bold text-primary" id="daily-streak-display">🔥 0</div>
                                                <div class="text-white-50">Días de Racha</div>
                                            </div>
                                            <div class="col-md-6 mt-3 mt-md-0 d-grid"><button class="btn btn-lg btn-outline-primary" id="claim-daily-reward-btn" disabled>Reclamar Recompensa</button></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña: Pedidos -->
                        <div class="tab-pane fade" id="pills-pedidos" role="tabpanel" aria-labelledby="pills-pedidos-tab" tabindex="0">
                            <div class="settings-card p-4">
                                <h4 class="mb-3"><i class="bi bi-key-fill me-2"></i>Cuentas Compradas</h4>
                                <div id="profile-purchases-list" class="mb-4"></div>
                                <hr class="my-4">
                                <h4 class="mb-3"><i class="bi bi-receipt-cutoff me-2"></i>Historial de Pedidos</h4>
                                <div id="profile-history-list" class="table-responsive"></div>
                            </div>
                        </div>

                        <!-- Pestaña: Colección -->
                        <div class="tab-pane fade" id="pills-coleccion" role="tabpanel" aria-labelledby="pills-coleccion-tab" tabindex="0">
                            <div class="settings-card p-4">
                                <h4 class="mb-3"><i class="bi bi-heart-fill me-2"></i>Mis Favoritos</h4>
                                <div class="row gy-4 mb-4" id="profile-favorites-list"></div>
                                <hr class="my-4">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h4 class="mb-0"><i class="bi bi-trophy-fill me-2"></i>Mis Logros</h4>
                                    <div id="achievement-filters" class="btn-group btn-group-sm">
                                        <!-- Los filtros se generan aquí -->
                                    </div>
                                </div>
                                <div class="row gy-4" id="profile-achievements-list"></div>
                            </div>
                        </div>

                        <!-- Pestaña: Ajustes -->
                        <div class="tab-pane fade" id="pills-ajustes" role="tabpanel" aria-labelledby="pills-ajustes-tab" tabindex="0">
                            <div class="row gy-4">
                                <div class="col-lg-6"><div class="settings-card p-4 h-100"><h4 class="mb-4"><i class="bi bi-person-badge-fill me-2"></i>Cuenta</h4><div class="mb-3"><label for="user-name-input" class="form-label">Nombre de Usuario</label><div class="input-group"><input type="text" class="form-control" id="user-name-input" placeholder="Elige un nombre"><button class="btn btn-primary" id="save-details-btn">Guardar</button></div></div></div></div>
                                <div class="col-lg-6"><div class="settings-card p-4 h-100"><h4 class="mb-4"><i class="bi bi-palette-fill me-2"></i>Apariencia</h4><p class="text-white-50">Elige tu tema preferido.</p><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="theme" id="darkTheme" value="dark"><label class="form-check-label" for="darkTheme">Oscuro</label></div><div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="theme" id="lightTheme" value="light"><label class="form-check-label" for="lightTheme">Claro</label></div></div></div>
                                <div class="col-lg-6"><div class="settings-card p-4 h-100"><h4 class="mb-4"><i class="bi bi-globe-americas me-2"></i>País y Moneda</h4><p class="text-white-50">Selecciona tu país para ver precios locales.</p><div class="input-group"><span class="input-group-text" id="country-flag-container"></span><select class="form-select" id="user-country"></select></div></div></div>
                                <div class="col-lg-6"><div class="settings-card p-4 h-100"><h4 class="mb-4"><i class="bi bi-speedometer2 me-2"></i>Rendimiento</h4><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" id="animationsSwitch"><label class="form-check-label" for="animationsSwitch">Habilitar animaciones de fondo</label></div><p class="text-white-50 small mt-2">Desactiva esto si experimentas lentitud.</p></div></div>
                                <div class="col-lg-6"><div class="settings-card p-4 h-100"><h4 class="mb-4"><i class="bi bi-bell-fill me-2"></i>Notificaciones</h4><div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" id="notificationsSwitch"><label class="form-check-label" for="notificationsSwitch">Mostrar notificaciones de compra</label></div></div></div>
                                <div class="col-lg-6"><div class="settings-card p-4 h-100"><h4 class="mb-4"><i class="bi bi-box-arrow-right me-2"></i>Sesión</h4><p class="text-white-50">Cierra tu sesión actual en este dispositivo.</p><button class="btn btn-outline-danger" id="logoutBtn">Cerrar Sesión</button></div></div>
                                <div class="col-lg-12">
                                    <div class="settings-card p-4">
                                        <h4 class="mb-3"><i class="bi bi-clock-history me-2"></i>Historial de Sesiones</h4>
                                        <p class="text-white-50 small">Aquí puedes ver los accesos recientes a tu cuenta.</p>
                                        <div id="login-history-container" class="table-responsive" style="max-height: 250px; overflow-y: auto;"></div>
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div class="settings-card p-4">
                                        <h4 class="mb-4 text-danger"><i class="bi bi-exclamation-triangle-fill me-2"></i>Zona de Peligro</h4>
                                        <div class="row gy-3">
                                            <div class="col-md-6">
                                                <h5 class="fs-6"><i class="bi bi-cloud-arrow-down-fill me-2"></i>Copia de Seguridad</h5>
                                                <p class="text-white-50 small">Exporta o importa tus datos (carrito, favoritos, etc.).</p>
                                                <button class="btn btn-outline-info btn-sm me-2" id="exportDataBtn">Exportar Datos</button>
                                                <button class="btn btn-outline-success btn-sm" id="importDataBtn">Importar Datos</button>
                                                <input type="file" id="importFileInput" class="d-none" accept=".json">
                                            </div>
                                            <div class="col-md-6">
                                                <h5 class="fs-6"><i class="bi bi-trash3-fill me-2"></i>Limpiar Datos</h5>
                                                <p class="text-white-50 small">Borra todos los datos de la aplicación en tu navegador.</p>
                                                <button class="btn btn-danger btn-sm" id="clearDataBtn">Limpiar Datos Locales</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña: Soporte -->
                        <div class="tab-pane fade" id="pills-soporte" role="tabpanel" aria-labelledby="pills-soporte-tab" tabindex="0">
                            <div class="settings-card p-4">
                                <h4 class="mb-3"><i class="bi bi-exclamation-triangle-fill me-2"></i>Reportar un Problema</h4>
                                <p class="text-white-50">Si tienes algún problema con una de tus cuentas, por favor, completa el formulario.</p>
                                <form id="support-form" method="POST">
                                    <input type="hidden" name="form-name" value="reporte-problema" />
                                    <p class="d-none"><label>Don’t fill this out if you’re human: <input name="bot-field" /></label></p>
                                    <!-- Campos ocultos para los detalles de la cuenta -->
                                    <input type="hidden" id="support-product-name" name="producto">
                                    <input type="hidden" id="support-account-email" name="correo_cuenta">
                                    <input type="hidden" id="support-account-password" name="clave_cuenta">
                                    <div class="row">
                                        <div class="col-md-6 mb-3"><label for="support-name" class="form-label">Tu Nombre</label><input type="text" class="form-control" id="support-name" name="nombre" required></div>
                                        <div class="col-md-6 mb-3"><label for="support-phone" class="form-label">Teléfono (Opcional)</label><input type="tel" class="form-control" id="support-phone" name="telefono"></div>
                                    </div>
                                    <div class="mb-3"><label for="support-account" class="form-label">Selecciona la cuenta con el problema</label><select class="form-select" id="support-account" name="cuenta_seleccionada" required></select></div>
                                    <div class="mb-3"><label for="support-description" class="form-label">Describe el problema</label><textarea class="form-control" id="support-description" name="descripcion" rows="4" placeholder="Ej: La contraseña no funciona..." required></textarea></div>
                                    <div class="d-grid"><button type="submit" class="btn btn-warning mt-3">Enviar Reporte</button></div>
                                </form>
                                <div id="support-success-message" class="alert alert-success mt-3 d-none" role="alert">¡Reporte enviado! Nos pondremos en contacto contigo pronto.</div>
                                <hr class="my-4">
                                <h4 class="mb-3"><i class="bi bi-check-circle-fill me-2"></i>Reportes Solucionados</h4>
                                <div id="solved-tickets-list"></div>
                            </div>
                        </div>

                        <!-- Pestaña: Novedades -->
                        <div class="tab-pane fade" id="pills-novedades" role="tabpanel" aria-labelledby="pills-novedades-tab" tabindex="0">
                            <div class="settings-card p-4">
                                <h4 class="mb-4"><i class="bi bi-newspaper me-2"></i>Anuncios y Novedades de la Tienda</h4>
                                <div id="announcements-container"></div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Historial de Transacciones -->
    <div class="modal fade" id="transactionHistoryModal" tabindex="-1" aria-labelledby="transactionHistoryModalLabel" aria-hidden="true" data-bs-theme="dark">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content settings-card">
                <div class="modal-header border-0">
                    <h1 class="modal-title fs-5" id="transactionHistoryModalLabel"><i class="bi bi-clock-history me-2"></i>Historial de Transacciones</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="transaction-history-container" class="table-responsive">
                        <!-- El historial se cargará aquí -->
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="favoritos.js"></script>
    <script src="cart.js"></script>
    <script src="script.js"></script>
    <script src="perfil.js"></script>
    <script src="movil.js"></script>
</body>
</html>